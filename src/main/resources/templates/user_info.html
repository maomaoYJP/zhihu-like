<!DOCTYPE html>
<html lang="ZH-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>用户信息</title>
    <link rel="stylesheet" href="../static/css/maomao.css" th:href="@{/css/maomao.css}">
</head>
<body class="flex flex1 column" style="margin: 0">
    <div class="m-backcolor">
        <div class="flex m-mg8">
            <a th:href="@{/home}" class="m-font-gray m-underlineCancel">返回</a>
        </div>
    </div>
    <div class="m-mg8">
        <div>
            <form method="post" enctype="multipart/form-data" id="file_upload">
                <img id="image-preview" style="border-radius: 50%;width: 50px;height: 50px">
                <input type="file" id="file" name="upload_image" accept="image/gif, image/jpeg, image/png, image/jpg">
                <p id="info"></p>
            </form>
        </div>
        <div>基本资料</div>
        <form th:action="@{/editData/save}" method="post">
            <input type="text" hidden="true" th:value="${userInfo.getId()}" name="id">
            <div class="flex flex1" style="margin-top: 8px">
                <label class="m-font-gray" style="font-size: 13px;margin-right: 8px" for="nickname">昵称</label>
                <input th:value="${userInfo.getNickname()}" type="text" name="nickname" id="nickname" placeholder="昵称">
            </div>
            <div class="flex flex1" style="margin-top: 8px">
                <label class="m-font-gray" style="font-size: 13px;margin-right: 8px" for="introduce">介绍</label>
                <input th:value="${userInfo.getIntroduce()}" type="text" name="introduce" id="introduce" placeholder="介绍">
            </div>
            <div class="flex flex1" style="margin-top: 8px">
                <label class="m-font-gray" style="font-size: 13px;margin-right: 8px" for="sex">性别</label>
                <input th:value="${userInfo.getSex()}" type="text" name="sex" id="sex" placeholder="性别">
            </div>
            <div class="flex flex1" style="margin-top: 8px">
                <label class="m-font-gray" style="font-size: 13px;margin-right: 8px" for="birthday">生日</label>
                <input th:value="${#dates.format(userInfo.getBirthday(), 'yyyy-MM-dd')}" type="text" name="birthdayString" id="birthday" placeholder="生日">
            </div>
            <div class="flex flex1" style="margin-top: 8px">
                <label class="m-font-gray" style="font-size: 13px;margin-right: 8px" for="occupation">职业</label>
                <input th:value="${userInfo.getOccupation()}" type="text" name="occupation" id="occupation" placeholder="职业">
            </div>
            <div class="flex flex1" style="justify-content: flex-end;margin-right: 8px">
                <button type="submit">保存</button>
            </div>
        </form>
    </div>
</body>

<script type="text/javascript">
    let fileInput = document.getElementById('file');
    let info = document.getElementById('info');
    let preview = document.getElementById('image-preview');

    fileInput.addEventListener("change",function () {
        preview.style.backgroundImage = "";
        info.innerHTML = "";
        if(!fileInput.value){
            info.innerHTML = "没有选择文件";
            return ;
        }
        let file = fileInput.files[0];
        let size = file.size;
        if(size > 1024 * 1024){
            alert("文件大小超出限制");
            info.innerHTML = "文件大小超出限制";
            return false;
        }
        // 读取文件
        let reader = new FileReader();
        reader.readAsDataURL(file);
        //读取完成之后，得到结果，传给preview
        reader.onload = function (e) {
            let result = e.target.result;
            preview.src = result;
        }
    })
</script>
</html>