<!DOCTYPE html>
<html lang="ZH-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>关注</title>
    <link rel="stylesheet" href="../static/css/maomao.css" th:href="@{/css/maomao.css}">
    <meta name="viewport" content="width=device-width, initial-scale=1 user-scalable=no" />
</head>
<body class="flex flex1 column" style="background-color: #e8e8e8;margin: 0">
<div class="m-backcolor">
    <div class="flex m-mg8" id="return">
        <span class="m-font-gray m-card-title">返回</span>
        <div class="flex1 m-card-title" style="text-align: center;margin-left: -30px">粉丝</div>
    </div>
</div>
    <div class="flex flex1 column">
        <div th:each="follow,followStat : ${follows}" class="flex m-backcolor" style="margin-bottom: 1px">
            <img th:src="${follow.getPortrait()}" alt="" class="m-headPicture-circle m-mg8" style="width: 40px;height: 40px" src="https://maomao-image.oss-cn-guangzhou.aliyuncs.com/img/20220801204640.png">
            <div class="flex column m-mg8">
                <input th:value="${follow.getId()}" hidden="true" name="followId"/>
                <div th:text="${follow.getNickname()}" class="m-card-title">毛毛</div>
                <div th:text="${follow.getIntroduce().length() > 11 ? follow.getIntroduce().substring(0,11) : follow.getIntroduce()}" class="m-font-gray m-card-introduce">这是关注列表</div>
            </div>
            <div class="flex1" style="text-align: right">
                <button th:if="${followStat.index <= followSize - 1}" value="1" name="follow-btn" class="m-cancelFollow m-card-title" style="margin-right: 8px;margin-top: 14px">取关</button>
                <button th:if="${followStat.index > followSize - 1}" value="0" name="follow-btn" class="m-card-title" style="margin-right: 8px;margin-top: 14px">关注</button>
            </div>
        </div>
    </div>
</body>
<script type="text/javascript" src="../static/js/jquery-2.0.3.js" th:src="@{/js/jquery-2.0.3.js}"></script>
<script>
    //点击返回，去到上一个页面
    $("#return").click(function () {
        window.history.back()
    })
    $("[name= 'follow-btn']").click(function (e) {
        this.value === "0" ? addFollow(e) : removeFollow(e);
    })

    addFollow = function(e) {
        let followId = e.target.parentElement.previousElementSibling.firstElementChild.value;
        $.ajax({
            url:"/addFollow/" + followId,
            type : 'GET',
            dataType : 'text',
            success :function(data){
                //发送成功改变按钮
                e.target.className = "m-cancelFollow m-card-title";
                e.target.value = 1;
                e.target.innerText = "取关";
            }
        })
    }

    removeFollow = function (e) {
        let followId = e.target.parentElement.previousElementSibling.firstElementChild.value;
        $.ajax({
            url:"/removeFollow/" + followId,
            type : 'GET',
            dataType : 'text',
            success :function(data){
                //发送成功改变按钮
                e.target.removeAttribute("class","m-cancelFollow");
                e.target.className = "m-card-title";
                e.target.value = 0;
                e.target.innerText = "关注";
            }
        })
    }
</script>

</html>